# project_checker
* проект имеет два скрипта: fetch_allure_project_ids и fetch_allure_owner_emails:
________________________________________________________________________________________________________________________________

fetch_allure_project_ids - необходим для формирования файла CSV, в котором будут находиться projectId проектов из ТестОпс

### Главные особенности fetch_allure_project_ids

Авторизация через API-токен
- Скрипт получает JWT-токен по API-токену пользователя с помощью запроса к /api/uaa/oauth/token и использует его в Authorization: Bearer … для всех остальных запросов.

Поддержка самоподписанных сертификатов
- Параметр verify=False во всех запросах отключает проверку SSL-сертификата, а предупреждения об этом подавляются через urllib3.disable_warnings.

Постраничная загрузка данных
- Скрипт перебирает страницы на эндпоинте /api/rs/project с параметрами page, size, sort, пока не получит все проекты. 
- Поддерживает оба формата ответа API: с content и простой список.

Оптимизация HTTP-запросов
- Используется requests.Session() для повторного использования соединений и общих заголовков — это ускоряет работу и снижает нагрузку на сервер.

Гибкая настройка через переменные окружения
- Домен сервера (ALLURE_ENDPOINT), токен (ALLURE_USER_TOKEN) и имя файла (OUT_CSV) можно задавать через переменные окружения, не меняя код.

Надёжная обработка ошибок
- На каждом запросе вызывается raise_for_status() — при ошибках API или сети выполнение прерывается с понятным исключением.

Чистый вывод в CSV
- Результат — простой файл, где каждый проектный ID записан в отдельной строке в UTF-8, что удобно для последующей обработки другими скриптами.

Фильтрация пустых значений
- Если в ответе API попадутся проекты без id, они будут отфильтрованы, чтобы CSV оставался корректным.
___________________________________________________________________________________________________________________________

fetch_allure_owner_emails - необходим для формирования файла CSV, в котором будут находиться email'ы владельцев проектов из ТестОпс.

### Главные особенности fetch_allure_owner_emails

Авторизация через заголовок
- Скрипт использует Authorization: <TOKEN_TYPE> <ALLURE_TOKEN> (обычно Api-Token …, при желании — Bearer …) без отдельного получения JWT.

Поддержка самоподписанных сертификатов
- Во всех запросах стоит verify=False, а предупреждения подавляются через urllib3.disable_warnings.

Чтение ProjectID из CSV рядом со скриптом
- Берёт project_ids.csv из той же папки (через file), извлекает все числовые ID, удаляет дубликаты и сохраняет порядок.

Получение коллабораторов по проекту
- Для каждого ID вызывает GET {BASE}/api/project/access/{projectId}/collaborator, понимает разные формы ответа (список и обёртки content/items/results/data/collaborators), делает небольшую паузу между запросами.

Точное определение владельца
- Считает владельцами записи с permissionSetName = "Project Owner" (нормализация регистра и пробелов). Дополнительно проверяет role, projectRole.name, isOwner/owner/projectOwner, accessLevel.

Надёжное извлечение e-mail
- Проверяет поля email/mail/username/login на верхнем уровне и во вложенном user, с простой валидацией формата адреса.

Чистый результат в CSV
- Сохраняет уникальные e-mail в emails.csv (по одному адресу на строку, UTF-8).

Гибкая настройка через окружение
- ALLURE_BASE_URL, ALLURE_TOKEN, TOKEN_TYPE и имена файлов можно задать через переменные окружения, не меняя код.

Прозрачный прогресс и отладка
- Печатает шаги обработки по каждому проекту; режим DEBUG_MODE показывает примеры сырых объектов для быстрой диагностики.

Обработка ошибок и «нетипичных» ответов
- raise_for_status() на каждом запросе, аккуратные try/except для HTTP/сети/JSON и сводка по ролям, если владельцы не найдены.
________________________________________________________________________________________________________________________________
